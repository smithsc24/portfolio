"use strict";(self.webpackChunkbasic_portfolio_site=self.webpackChunkbasic_portfolio_site||[]).push([[8472],{21387:(t,e,i)=>{i.d(e,{l:()=>o});var r=i(82425),s=i(58261),a=i(14750);class o extends a.A{constructor(){super(...arguments),this._hasCrossfade=!1}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(t){super.beforeRender(t),this._manageFade()}prepareRenderPasses(t){const e=t.registerRenderPass({name:"bitmap",brushes:[r.d.bitmap],target:()=>this.children,drawPhase:s.S5.MAP});return[...super.prepareRenderPasses(t),e]}_manageFade(){this.children.reduce(((t,e)=>t+(e.inFadeTransition?1:0)),0)>=2?(this.children.forEach((t=>t.blendFunction="additive")),this._hasCrossfade=!0):(this.children.forEach((t=>t.blendFunction="standard")),this._hasCrossfade=!1)}}},58472:(t,e,i)=>{i.r(e),i.d(e,{default:()=>P});var r=i(70273),s=i(11434),a=i(92976),o=i(73896),h=i(67519),n=(i(27052),i(11215),i(55292)),p=i(60733),d=i(21387),l=i(51163),c=i(47618),u=i(32936),g=i(90444),m=i(17302),y=i(59578),_=i(79053);const f=t=>{let e=class extends t{initialize(){this.exportImageParameters=new y.g({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){var t,e;return null!==(t=null===(e=this.view)||void 0===e?void 0:e.floors)&&void 0!==t?t:null}get exportImageVersion(){var t;return null!==(t=this.exportImageParameters)&&void 0!==t&&t.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}get timeExtent(){var t;return(0,_.F)(this.layer,null===(t=this.view)||void 0===t?void 0:t.timeExtent,this._get("timeExtent"))}canResume(){var t;return!!super.canResume()&&!(null!==(t=this.timeExtent)&&void 0!==t&&t.isEmpty)}};return(0,r._)([(0,h.MZ)()],e.prototype,"exportImageParameters",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],e.prototype,"floors",null),(0,r._)([(0,h.MZ)({readOnly:!0})],e.prototype,"exportImageVersion",null),(0,r._)([(0,h.MZ)()],e.prototype,"layer",void 0),(0,r._)([(0,h.MZ)()],e.prototype,"suspended",void 0),(0,r._)([(0,h.MZ)({readOnly:!0})],e.prototype,"timeExtent",null),e=(0,r._)([(0,n.$)("esri.views.layers.MapImageLayerView")],e),e};var v=i(96277),x=i(52795),M=i(45032);let w=class extends(f((0,v.A)((0,l.e)(m.A)))){constructor(){super(...arguments),this._highlightGraphics=new p.Y,this._updateHash=""}fetchPopupFeaturesAtLocation(t,e){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,e)}update(t){const e="".concat(this.exportImageVersion,"/").concat(t.state.id,"/").concat(t.pixelRatio,"/").concat(t.stationary);this._updateHash!==e&&(this._updateHash=e,this.strategy.update(t).catch((t=>{(0,a.zf)(t)||s.A.getLogger(this).error(t)})),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:e,version:i}=this.layer,r=i>=10.3,s=i>=10;this._bitmapContainer=new d.l,this.container.addChild(this._bitmapContainer),this._highlightView=new c.A({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new u.A(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new x.Uh({createFetchPopupFeaturesQueryGeometry:(t,e)=>(0,M.V)(t,e,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(t,e)=>{this._highlightView.graphicUpdateHandler({graphic:t,property:e})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new g.A({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:e,imageRotationSupported:r,imageNormalizationSupported:s,hidpi:!0}),this.addAttachHandles((0,o.wB)((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,e,i,r){return this.layer.fetchImage(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(t,e,i,r){return this.layer.fetchImageBitmap(t,e,i,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(t){return this._popupHighlightHelper.highlight(t)}};(0,r._)([(0,h.MZ)()],w.prototype,"strategy",void 0),(0,r._)([(0,h.MZ)()],w.prototype,"updating",void 0),w=(0,r._)([(0,n.$)("esri.views.2d.layers.MapImageLayerView2D")],w);const P=w},90444:(t,e,i)=>{i.d(e,{A:()=>R});var r=i(70273),s=i(27907),a=(i(27052),i(92976)),o=i(67519),h=(i(11434),i(11215),i(55292)),n=i(23423),p=i(38609),d=i(27913);const l=Math.PI/180;function c(t){return t*l}function u(t,e){const i=c(e.rotation),r=Math.abs(Math.cos(i)),s=Math.abs(Math.sin(i)),[a,o]=e.size;return t[0]=Math.round(o*s+a*r),t[1]=Math.round(o*r+a*s),t}var g=i(15930),m=i(1444),y=i(5971);const _=(0,n.vt)(),f=[0,0],v=new y.A(0,0,0,0),x=2048,M=2048,w=!1,P=!1,b=!1;let S=class extends s.A{constructor(t){super(t),this._imagePromise=null,this.bitmaps=[],this.hidpi=b,this.imageMaxWidth=x,this.imageMaxHeight=M,this.imageRotationSupported=w,this.imageNormalizationSupported=P,this.update=(0,a.sg)((async(t,e)=>{var i,r;if((0,a.Te)(e),!t.stationary||this.destroyed)return;const s=t.state,o=(0,p.Vp)(s.spatialReference),h=this.hidpi?t.pixelRatio:1,n=s.worldScreenWidth>0,d=n&&this.imageNormalizationSupported&&s.worldScreenWidth<s.size[0],l=Math.round((null!==(i=this.imageMaxWidth)&&void 0!==i?i:0)/h),c=Math.round((null!==(r=this.imageMaxHeight)&&void 0!==r?r:0)/h);d?(f[0]=s.worldScreenWidth,f[1]=s.size[1]):this.imageRotationSupported?(f[0]=s.size[0],f[1]=s.size[1]):u(f,s);const g=Math.floor(f[0])>l||Math.floor(f[1])>c,m=o&&(s.extent.xmin<o.valid[0]||s.extent.xmax>o.valid[1]),y=!this.imageNormalizationSupported&&m,_=!g&&!y,v=this.imageRotationSupported?s.rotation:0,x=this.container.children.slice();if(_){const t=d?s.paddedViewState.center:s.center;this._imagePromise=this._singleExport(s,f,t,s.resolution,v,h,e)}else{let t=Math.min(l,c);n&&(t=Math.min(s.worldScreenWidth,t),t=Math.round(s.worldScreenWidth/Math.ceil(s.worldScreenWidth/t))),this._imagePromise=this._tiledExport(s,t,h,e)}try{var M;const t=null!==(M=await this._imagePromise)&&void 0!==M?M:[];(0,a.Te)(e);const i=[];if(this._imagePromise=null,this.destroyed)return;this.bitmaps=t;for(const e of x)t.includes(e)||i.push(e.fadeOut().then((()=>{e.remove(),e.destroy()})));for(const e of t)i.push(e.fadeIn());await Promise.all(i)}catch(w){this._imagePromise=null,(0,a.QP)(w)}}),5e3),this.updateExports=(0,a.sg)((async t=>{const e=[];for(const i of this.container.children){if(!i.visible||!i.stage)return;e.push(t(i).then((()=>{i.invalidateTexture(),i.requestRender()})))}this._imagePromise=(0,a.Lx)(e).then((()=>this._imagePromise=null)),await this._imagePromise}))}destroy(){this.bitmaps.forEach((t=>t.destroy())),this.bitmaps=[]}get updating(){return!this.destroyed&&null!==this._imagePromise}async _export(t,e,i,r,s,o){const h=await this.fetchSource(t,Math.floor(e*s),Math.floor(i*s),{rotation:r,pixelRatio:s,signal:o});(0,a.Te)(o);const n=new g.mb(null,!0);return n.x=t.xmin,n.y=t.ymax,n.resolution=t.width/e,n.rotation=r,n.pixelRatio=s,n.opacity=0,this.container.addChild(n),await n.setSourceAsync(h,o),(0,a.Te)(o),n}async _singleExport(t,e,i,r,s,a,o){!function(t,e,i,r){const[s,a]=e,[o,h]=r,n=.5*i;t[0]=s-n*o,t[1]=a-n*h,t[2]=s+n*o,t[3]=a+n*h}(_,i,r,e);const h=(0,n.w1)(_,t.spatialReference);return[await this._export(h,e[0],e[1],s,a,o)]}_tiledExport(t,e,i,r){const s=d.A.create({size:e,spatialReference:t.spatialReference,scales:[t.scale]}),a=new m.A(s),o=a.getTileCoverage(t);if(!o)return null;const h=[];return o.forEach(((s,o,p,d)=>{v.set(s,o,p,0),a.getTileBounds(_,v);const l=(0,n.w1)(_,t.spatialReference);h.push(this._export(l,e,e,0,i,r).then((t=>(0!==d&&(v.set(s,o,p,d),a.getTileBounds(_,v),t.x=_[0],t.y=_[3]),t))))})),Promise.all(h)}};(0,r._)([(0,o.MZ)()],S.prototype,"_imagePromise",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"bitmaps",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"container",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"fetchSource",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"hidpi",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"imageMaxWidth",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"imageMaxHeight",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"imageRotationSupported",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"imageNormalizationSupported",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"requestUpdate",void 0),(0,r._)([(0,o.MZ)()],S.prototype,"updating",null),S=(0,r._)([(0,h.$)("esri.views.2d.layers.support.ExportStrategy")],S);const R=S}}]);
//# sourceMappingURL=8472.5dabad98.chunk.js.map